<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EdGame System Architecture — Phase 1</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  html{font-size:14px}
  body{
    font-family:'Inter',system-ui,sans-serif;
    background:#0d0d1a;
    color:#e0e0e0;
    min-height:100vh;
    padding:0;
    -webkit-font-smoothing:antialiased;
  }

  /* ── Title Bar ── */
  .title-bar{
    background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
    padding:28px 48px;
    border-bottom:3px solid #0f3460;
    display:flex;justify-content:space-between;align-items:center;
  }
  .title-bar h1{font-size:1.65rem;font-weight:700;color:#fff;letter-spacing:-.3px}
  .title-bar h1 span{color:#00d4ff;font-weight:300}
  .title-bar .meta{font-size:.85rem;color:#8892b0;font-weight:400;text-align:right;line-height:1.5}

  /* ── Canvas ── */
  .canvas{
    max-width:1860px;margin:0 auto;padding:32px 40px 48px;
    position:relative;
  }

  /* ── Layers ── */
  .layer{
    border-radius:14px;
    padding:22px 28px 26px;
    margin-bottom:18px;
    position:relative;
  }
  .layer-label{
    font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:1.6px;
    margin-bottom:14px;color:#8892b0;display:flex;align-items:center;gap:8px;
  }
  .layer-label .num{
    background:#0f3460;color:#00d4ff;width:22px;height:22px;border-radius:50%;
    display:inline-flex;align-items:center;justify-content:center;font-size:.65rem;
  }

  .l1{background:linear-gradient(180deg,#1e1e30 0%,#1a1a2e 100%);border:1px solid #2a2a40}
  .l2{background:linear-gradient(180deg,#16213e 0%,#142038 100%);border:1px solid #1e3050}
  .l3{background:linear-gradient(180deg,#0f1a30 0%,#0d1628 100%);border:1px solid #162848}
  .l4{background:linear-gradient(180deg,#0a1220 0%,#080e1a 100%);border:1px solid #122040}
  .l5{background:linear-gradient(180deg,#0f3460 0%,#0a2848 100%);border:1px solid #185090}

  /* ── Boxes ── */
  .box-row{display:flex;gap:18px;flex-wrap:wrap}
  .box{
    background:#12182a;
    border:1px solid #1e2d48;
    border-radius:10px;
    padding:16px 20px;
    flex:1;min-width:200px;
    box-shadow:0 4px 20px rgba(0,0,0,.35);
    transition:border-color .2s;
  }
  .box:hover{border-color:#0f3460}
  .box-title{
    font-size:.82rem;font-weight:600;color:#00d4ff;margin-bottom:10px;
    display:flex;align-items:center;gap:8px;
  }
  .box-title .icon{font-size:1rem;opacity:.8}
  .box ul{list-style:none;padding:0}
  .box ul li{
    font-size:.75rem;color:#a0aec0;padding:3px 0 3px 14px;
    position:relative;line-height:1.45;
  }
  .box ul li::before{
    content:'';position:absolute;left:0;top:10px;
    width:6px;height:6px;border-radius:50%;background:#0f3460;
  }

  /* ── External User Cards ── */
  .user-cards{display:flex;gap:18px;justify-content:center}
  .user-card{
    background:#12182a;border:1px solid #2a2a40;border-radius:10px;
    padding:18px 28px;text-align:center;min-width:200px;
    box-shadow:0 4px 20px rgba(0,0,0,.3);
  }
  .user-card .icon-circle{
    width:48px;height:48px;border-radius:50%;
    display:inline-flex;align-items:center;justify-content:center;
    font-size:1.3rem;margin-bottom:8px;
  }
  .user-card:nth-child(1) .icon-circle{background:linear-gradient(135deg,#0f3460,#00d4ff)}
  .user-card:nth-child(2) .icon-circle{background:linear-gradient(135deg,#0f3460,#4ade80)}
  .user-card:nth-child(3) .icon-circle{background:linear-gradient(135deg,#0f3460,#fbbf24)}
  .user-card .name{font-size:.82rem;font-weight:600;color:#fff}
  .user-card .sub{font-size:.68rem;color:#8892b0;margin-top:2px}

  /* ── Wide box ── */
  .box.wide{flex:2;min-width:380px}

  /* ── SVG Arrows ── */
  .arrows-svg{
    position:absolute;top:0;left:0;width:100%;height:100%;
    pointer-events:none;z-index:10;
  }

  /* ── Arrow connectors (CSS-based) ── */
  .connector-zone{
    display:flex;justify-content:center;gap:120px;
    padding:4px 0;position:relative;
  }
  .arrow-down{
    display:flex;flex-direction:column;align-items:center;gap:0;
  }
  .arrow-down .line{
    width:2px;height:14px;background:#0f3460;
  }
  .arrow-down .head{
    width:0;height:0;
    border-left:5px solid transparent;border-right:5px solid transparent;
    border-top:7px solid #0f3460;
  }
  .arrow-down .label{
    font-size:.6rem;color:#00d4ff;font-family:'JetBrains Mono',monospace;
    background:#0d0d1a;padding:1px 6px;border-radius:3px;
    white-space:nowrap;margin:2px 0;
  }
  .arrow-down.bidirectional .head-up{
    width:0;height:0;
    border-left:5px solid transparent;border-right:5px solid transparent;
    border-bottom:7px solid #fbbf24;
  }

  /* ── Legend ── */
  .legend{
    position:absolute;bottom:16px;right:40px;
    background:#12182a;border:1px solid #1e2d48;border-radius:10px;
    padding:14px 20px;box-shadow:0 4px 20px rgba(0,0,0,.4);
    z-index:20;
  }
  .legend h4{font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;color:#8892b0;margin-bottom:8px}
  .legend-item{display:flex;align-items:center;gap:8px;margin-bottom:5px}
  .legend-item .swatch{width:14px;height:10px;border-radius:3px}
  .legend-item .txt{font-size:.68rem;color:#a0aec0}

  /* ── Sub-layer label ── */
  .sub-layer-badge{
    display:inline-block;background:#185090;color:#00d4ff;
    font-size:.6rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;
    padding:2px 8px;border-radius:4px;margin-bottom:8px;
  }

  /* ── Print ── */
  @media print{
    body{background:#fff;color:#111}
    .layer{border:1px solid #ccc;background:#f9f9f9!important}
    .box{background:#fff;border:1px solid #ddd}
  }
</style>
</head>
<body>

<!-- Title Bar -->
<div class="title-bar">
  <h1>EdGame <span>—</span> System Architecture <span>— Phase 1</span></h1>
  <div class="meta">TIE 204 Lab 2<br>February 2026</div>
</div>

<div class="canvas">

  <!-- LAYER 1: External Users -->
  <div class="layer l1">
    <div class="layer-label"><span class="num">1</span> External Users &amp; Systems</div>
    <div class="user-cards">
      <div class="user-card">
        <div class="icon-circle">&#127891;</div>
        <div class="name">Student</div>
        <div class="sub">Browser (HTTPS)</div>
      </div>
      <div class="user-card">
        <div class="icon-circle">&#9989;</div>
        <div class="name">Teacher</div>
        <div class="sub">Browser (HTTPS)</div>
      </div>
      <div class="user-card">
        <div class="icon-circle">&#128279;</div>
        <div class="name">Google Classroom</div>
        <div class="sub">LTI 1.3 Integration</div>
      </div>
    </div>
  </div>

  <!-- Arrow zone L1 → L2 -->
  <div class="connector-zone">
    <div class="arrow-down">
      <div class="line"></div>
      <div class="label">HTTPS</div>
      <div class="head"></div>
    </div>
    <div class="arrow-down">
      <div class="line"></div>
      <div class="label">HTTPS</div>
      <div class="head"></div>
    </div>
    <div class="arrow-down">
      <div class="head-up" style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:7px solid #fbbf24;"></div>
      <div class="label" style="color:#fbbf24">LTI 1.3</div>
      <div class="head" style="border-top-color:#fbbf24"></div>
    </div>
  </div>

  <!-- LAYER 2: Client Software -->
  <div class="layer l2">
    <div class="layer-label"><span class="num">2</span> Client Software</div>
    <div class="box-row">
      <div class="box wide">
        <div class="box-title"><span class="icon">&#127918;</span> Game Client (KAPLAY.js)</div>
        <ul>
          <li>Scene Manager</li>
          <li>Event Collector (buffers events, batch POST every 10 s)</li>
          <li>Adaptive Difficulty Engine</li>
          <li>Question Engine (JSON &rarr; API provider pattern)</li>
          <li>Combat System (MCQ-gated action resolution)</li>
          <li>Progression System (XP, Levels, Badges)</li>
        </ul>
      </div>
      <div class="box">
        <div class="box-title"><span class="icon">&#128202;</span> Teacher Dashboard (Next.js + React)</div>
        <ul>
          <li>Class Overview</li>
          <li>Student Drill-down</li>
          <li>Top-3 Insights Cards</li>
          <li>Concept Mastery Heatmap</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Arrow zone L2 → L3 -->
  <div class="connector-zone">
    <div class="arrow-down">
      <div class="line"></div>
      <div class="label">REST + WebSocket</div>
      <div class="head"></div>
    </div>
    <div class="arrow-down">
      <div class="line"></div>
      <div class="label">REST + Realtime</div>
      <div class="head"></div>
    </div>
  </div>

  <!-- LAYER 3: Cloud Application -->
  <div class="layer l3">
    <div class="layer-label"><span class="num">3</span> Cloud Application (Vercel Edge Network)</div>
    <div class="box-row">
      <div class="box">
        <div class="box-title"><span class="icon">&#9889;</span> Next.js API Routes</div>
        <ul>
          <li>/api/sessions</li>
          <li>/api/assignments</li>
          <li>/api/analytics</li>
          <li>/api/environments</li>
        </ul>
      </div>
      <div class="box">
        <div class="box-title"><span class="icon">&#128737;</span> Edge Functions</div>
        <ul>
          <li>Auth middleware</li>
          <li>Rate limiting</li>
          <li>CORS policy</li>
        </ul>
      </div>
      <div class="box">
        <div class="box-title"><span class="icon">&#128279;</span> LTI 1.3 Bridge</div>
        <ul>
          <li>OIDC login flow</li>
          <li>Deep linking</li>
          <li>Grade passback</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Arrow zone L3 → L4 -->
  <div class="connector-zone">
    <div class="arrow-down">
      <div class="line"></div>
      <div class="label">PostgreSQL wire protocol</div>
      <div class="head"></div>
    </div>
  </div>

  <!-- LAYER 4: Backend Services -->
  <div class="layer l4">
    <div class="layer-label"><span class="num">4</span> Backend Services (Supabase)</div>
    <div class="box-row">
      <div class="box">
        <div class="box-title"><span class="icon">&#128451;</span> PostgreSQL</div>
        <ul>
          <li>users</li>
          <li>sessions</li>
          <li>metrics</li>
          <li>assignments</li>
          <li>game_environments</li>
        </ul>
      </div>
      <div class="box">
        <div class="box-title"><span class="icon">&#128272;</span> Auth</div>
        <ul>
          <li>JWT tokens</li>
          <li>Google OAuth</li>
          <li>Magic links</li>
          <li>Row Level Security</li>
        </ul>
      </div>
      <div class="box">
        <div class="box-title"><span class="icon">&#9889;</span> Realtime</div>
        <ul>
          <li>Live dashboard updates</li>
          <li>Submission notifications</li>
        </ul>
      </div>
      <div class="box">
        <div class="box-title"><span class="icon">&#128448;</span> Storage</div>
        <ul>
          <li>Game assets</li>
          <li>Sprites &amp; audio</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Arrow zone L4 → L5 -->
  <div class="connector-zone">
    <div class="arrow-down">
      <div class="line"></div>
      <div class="label">Session End Trigger</div>
      <div class="head"></div>
    </div>
    <div class="arrow-down" style="margin-left:200px">
      <div class="head-up" style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:7px solid #4ade80;"></div>
      <div class="label" style="color:#4ade80">Computed Insights &rarr; Dashboard</div>
      <div class="line" style="background:#4ade80"></div>
    </div>
  </div>

  <!-- LAYER 5: Analytics Engine -->
  <div class="layer l5">
    <div class="layer-label"><span class="num">5</span> Analytics Engine</div>
    <div class="box-row">
      <div class="box" style="background:#0a2040;border-color:#185090">
        <div class="box-title"><span class="icon">&#128200;</span> Metric Computation</div>
        <ul>
          <li>PostgreSQL functions</li>
          <li>15 core metrics</li>
        </ul>
      </div>
      <div class="box" style="background:#0a2040;border-color:#185090">
        <div class="box-title"><span class="icon">&#128197;</span> Daily Rollup</div>
        <ul>
          <li>Scheduled aggregation</li>
          <li>student_metrics_daily</li>
        </ul>
      </div>
      <div class="box" style="background:#0a2040;border-color:#185090">
        <div class="box-title"><span class="icon">&#128161;</span> Insight Generator</div>
        <ul>
          <li>Top-3 insights per student</li>
          <li>Priority ranking</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend">
    <h4>Legend</h4>
    <div class="legend-item">
      <div class="swatch" style="background:#1e1e30;border:1px solid #2a2a40"></div>
      <div class="txt">External Users</div>
    </div>
    <div class="legend-item">
      <div class="swatch" style="background:#16213e;border:1px solid #1e3050"></div>
      <div class="txt">Client Software</div>
    </div>
    <div class="legend-item">
      <div class="swatch" style="background:#0f1a30;border:1px solid #162848"></div>
      <div class="txt">Cloud Software (Vercel)</div>
    </div>
    <div class="legend-item">
      <div class="swatch" style="background:#0a1220;border:1px solid #122040"></div>
      <div class="txt">Backend (Supabase)</div>
    </div>
    <div class="legend-item">
      <div class="swatch" style="background:#0f3460;border:1px solid #185090"></div>
      <div class="txt">Analytics Engine</div>
    </div>
    <div class="legend-item" style="margin-top:8px;padding-top:6px;border-top:1px solid #1e2d48">
      <div style="width:14px;height:2px;background:#0f3460"></div>
      <div class="txt">Data flow (arrow)</div>
    </div>
    <div class="legend-item">
      <div style="width:14px;height:2px;background:#fbbf24"></div>
      <div class="txt">Bidirectional (LTI)</div>
    </div>
  </div>

</div>
</body>
</html>
